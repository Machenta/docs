---
title: 'Authentication'
description: 'OAuth and API key authentication for K12 APIM'
---

# Authentication

When calling the K12 Annex tools through the **K12 Azure Dev APIM**, you must authenticate using OAuth 2.0 client credentials flow.

## OAuth Configuration

| Setting | Value |
| --- | --- |
| **OAuth tenant** | `https://login.microsoftonline.com/{TENANT_ID}/oauth2/v2.0/token` |
| **Scope** | `api://k12-api-dev/.default` |
| **Grant type** | `client_credentials` |

## Required Headers

All API requests must include these headers:

| Header | Description |
| --- | --- |
| `Authorization` | `Bearer {access_token}` |
| `Ocp-Apim-Subscription-Key` | Your APIM subscription key |
| `Content-Type` | `application/json` |

## Environment Variables

Set these environment variables for your application:

| Variable | Description |
| --- | --- |
| `CLIENT_ID` | Azure AD app id with access to the K12 annex API scope |
| `CLIENT_SECRET` | Client secret for the Azure AD app |
| `TENANT_ID` | Directory/tenant containing the app registration |
| `ANNEX_SUBSCRIPTION_KEY` | APIM subscription key |
| `ANNEX_BASE_URL` | Base URL override (e.g., the APIM host) |

## Get Access Token

<CodeGroup>
```bash cURL
curl -X POST "https://login.microsoftonline.com/$TENANT_ID/oauth2/v2.0/token" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "client_id=$CLIENT_ID" \
  -d "client_secret=$CLIENT_SECRET" \
  -d "scope=api://k12-api-dev/.default" \
  -d "grant_type=client_credentials"
```

```javascript JavaScript
async function getAccessToken() {
  const params = new URLSearchParams({
    client_id: process.env.CLIENT_ID,
    client_secret: process.env.CLIENT_SECRET,
    scope: 'api://k12-api-dev/.default',
    grant_type: 'client_credentials'
  });

  const response = await fetch(
    `https://login.microsoftonline.com/${process.env.TENANT_ID}/oauth2/v2.0/token`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: params
    }
  );

  const data = await response.json();
  return data.access_token;
}
```

```python Python
import os
import requests

def get_access_token():
    tenant_id = os.environ['TENANT_ID']
    url = f"https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/token"
    
    data = {
        'client_id': os.environ['CLIENT_ID'],
        'client_secret': os.environ['CLIENT_SECRET'],
        'scope': 'api://k12-api-dev/.default',
        'grant_type': 'client_credentials'
    }
    
    response = requests.post(url, data=data)
    return response.json()['access_token']
```
</CodeGroup>

## Token Response

```json
{
  "token_type": "Bearer",
  "expires_in": 3600,
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIs..."
}
```

## Making Authenticated Requests

Once you have the token, include it in all API requests:

```javascript
const headers = {
  'Authorization': `Bearer ${accessToken}`,
  'Ocp-Apim-Subscription-Key': process.env.ANNEX_SUBSCRIPTION_KEY,
  'Content-Type': 'application/json'
};

const response = await fetch(`${BASE_URL}/api/tools/k12-annex-editing-kickoff/execute`, {
  method: 'POST',
  headers,
  body: JSON.stringify({ data: { /* ... */ } })
});
```

<Note>
For local development without APIM, you can omit the `Authorization` and `Ocp-Apim-Subscription-Key` headers when calling `http://localhost:4111` directly.
</Note>
